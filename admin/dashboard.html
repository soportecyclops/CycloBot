<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Panel de Administraci√≥n - CycloBot</title>
    <link rel="stylesheet" href="../public/css/styles.css">
    <link href="https://fonts.googleapis.com/css2?family=Exo+2:wght@300;400;500;600;700&family=Orbitron:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    
    <!-- Protecci√≥n de ruta MEJORADA -->
    <script>
        // Verificaci√≥n de autenticaci√≥n mejorada
        document.addEventListener('DOMContentLoaded', function() {
            const isAuthenticated = localStorage.getItem('cyclobot_admin') === 'true';
            const currentUser = localStorage.getItem('cyclobot_user');
            
            if (!isAuthenticated || !currentUser) {
                console.log('üîí No autenticado, redirigiendo a login...');
                window.location.href = '../admin/login.html';
                return;
            }
            
            // Mostrar usuario actual
            const userElement = document.getElementById('adminUser');
            if (userElement) {
                userElement.textContent = currentUser;
            }
            
            console.log('‚úÖ Usuario autenticado:', currentUser);
        });
    </script>
</head>
<body class="cyber-theme">
    <div class="admin-container">
        <!-- Header -->
        <header class="cyber-header">
            <div class="header-content">
                <h1 class="cyber-glitch-1" data-text="PANEL ADMINISTRACI√ìN">PANEL ADMINISTRACI√ìN</h1>
                <div class="admin-user">
                    <span id="adminUser" style="color: var(--accent-primary); margin-right: 1rem;">
                        <i class="fas fa-user-shield"></i> Administrador
                    </span>
                    <button id="logoutBtn" class="cyber-button">
                        <i class="fas fa-sign-out-alt"></i> Cerrar Sesi√≥n
                    </button>
                </div>
            </div>
        </header>

        <!-- Navegaci√≥n CORREGIDA -->
        <nav class="admin-nav">
            <button class="nav-btn active" data-panel="dashboardPanel">
                <i class="fas fa-tachometer-alt"></i> Dashboard
            </button>
            <button class="nav-btn" data-panel="databasePanel">
                <i class="fas fa-database"></i> Base de Datos
            </button>
            <button class="nav-btn" data-panel="statsPanel">
                <i class="fas fa-chart-bar"></i> Estad√≠sticas
            </button>
        </nav>

        <!-- Contenido Principal -->
        <main class="admin-main">
            <!-- Panel: Dashboard -->
            <div id="dashboardPanel" class="admin-panel active">
                <h2 class="cyber-title">üìä Dashboard del Sistema</h2>
                
                <div class="stats-grid">
                    <div class="stat-card cyber-card">
                        <div class="stat-icon">
                            <i class="fas fa-bug"></i>
                        </div>
                        <div class="stat-info">
                            <span class="stat-number" id="problemsCount">700+</span>
                            <span class="stat-label">Problemas Registrados</span>
                        </div>
                    </div>
                    
                    <div class="stat-card cyber-card">
                        <div class="stat-icon">
                            <i class="fas fa-check-circle"></i>
                        </div>
                        <div class="stat-info">
                            <span class="stat-number" id="effectivenessRate">85%</span>
                            <span class="stat-label">Efectividad</span>
                        </div>
                    </div>
                    
                    <div class="stat-card cyber-card">
                        <div class="stat-icon">
                            <i class="fas fa-database"></i>
                        </div>
                        <div class="stat-info">
                            <span class="stat-number status-ok" id="dbStatus">Conectada</span>
                            <span class="stat-label">Base de Datos</span>
                        </div>
                    </div>

                    <div class="stat-card cyber-card">
                        <div class="stat-icon">
                            <i class="fas fa-users"></i>
                        </div>
                        <div class="stat-info">
                            <span class="stat-number" id="usersCount">1,250</span>
                            <span class="stat-label">Usuarios Activos</span>
                        </div>
                    </div>
                </div>

                <div class="quick-actions">
                    <h3 class="cyber-subtitle">Acciones R√°pidas</h3>
                    <div class="action-buttons">
                        <button class="cyber-button" onclick="adminSystem.showPanel('databasePanel')">
                            <i class="fas fa-edit"></i> Gestionar Base de Datos
                        </button>
                        <button class="cyber-button" onclick="adminSystem.checkDatabase()">
                            <i class="fas fa-plug"></i> Verificar Conexi√≥n BD
                        </button>
                        <button class="cyber-button" onclick="adminSystem.exportData()">
                            <i class="fas fa-download"></i> Exportar Datos
                        </button>
                    </div>
                </div>

                <!-- Actividad Reciente -->
                <div class="recent-activity">
                    <h3 class="cyber-subtitle">Actividad Reciente</h3>
                    <div class="activity-list cyber-card">
                        <div class="activity-item">
                            <i class="fas fa-user-circle"></i>
                            <div class="activity-info">
                                <span>Usuario_123 complet√≥ diagn√≥stico</span>
                                <small>Hace 5 minutos - Hardware</small>
                            </div>
                        </div>
                        <div class="activity-item">
                            <i class="fas fa-user-circle"></i>
                            <div class="activity-info">
                                <span>Admin actualiz√≥ base de datos</span>
                                <small>Hace 15 minutos - Software</small>
                            </div>
                        </div>
                        <div class="activity-item">
                            <i class="fas fa-user-circle"></i>
                            <div class="activity-info">
                                <span>Nuevo problema registrado</span>
                                <small>Hace 30 minutos - Redes</small>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Panel: Base de Datos -->
            <div id="databasePanel" class="admin-panel">
                <h2 class="cyber-title">üóÉÔ∏è Gesti√≥n de Base de Datos</h2>
                
                <div class="database-controls">
                    <div class="control-group">
                        <h4>Tablas Disponibles</h4>
                        <select id="tableSelector" class="cyber-select">
                            <option value="problems">Problemas</option>
                            <option value="categories">Categor√≠as</option>
                            <option value="users">Usuarios</option>
                            <option value="solutions">Soluciones</option>
                        </select>
                    </div>
                    
                    <div class="control-group">
                        <h4>Acciones</h4>
                        <button class="cyber-button" onclick="adminSystem.loadTableData()">
                            <i class="fas fa-sync"></i> Cargar Datos
                        </button>
                        <button class="cyber-button" onclick="adminSystem.addNewItem()">
                            <i class="fas fa-plus"></i> Nuevo Registro
                        </button>
                    </div>
                </div>

                <div class="table-container">
                    <table class="db-table cyber-card">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Nombre</th>
                                <th>Categor√≠a</th>
                                <th>Estado</th>
                                <th>Acciones</th>
                            </tr>
                        </thead>
                        <tbody id="tableBody">
                            <tr>
                                <td colspan="5" style="text-align: center; padding: 2rem;">
                                    <i class="fas fa-database" style="font-size: 2rem; opacity: 0.5; margin-bottom: 1rem;"></i>
                                    <br>
                                    Selecciona una tabla y carga los datos
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Panel: Estad√≠sticas -->
            <div id="statsPanel" class="admin-panel">
                <h2 class="cyber-title">üìà Estad√≠sticas del Sistema</h2>
                <div class="stats-content cyber-card">
                    <div class="stats-grid-large">
                        <div class="stat-large">
                            <h4>Uso por Categor√≠a</h4>
                            <div class="stat-bar">
                                <div class="bar-label">Hardware</div>
                                <div class="bar-container">
                                    <div class="bar-fill" style="width: 45%"></div>
                                </div>
                                <span>45%</span>
                            </div>
                            <div class="stat-bar">
                                <div class="bar-label">Software</div>
                                <div class="bar-container">
                                    <div class="bar-fill" style="width: 30%"></div>
                                </div>
                                <span>30%</span>
                            </div>
                            <div class="stat-bar">
                                <div class="bar-label">Redes</div>
                                <div class="bar-container">
                                    <div class="bar-fill" style="width: 15%"></div>
                                </div>
                                <span>15%</span>
                            </div>
                            <div class="stat-bar">
                                <div class="bar-label">Otros</div>
                                <div class="bar-container">
                                    <div class="bar-fill" style="width: 10%"></div>
                                </div>
                                <span>10%</span>
                            </div>
                        </div>
                        
                        <div class="stat-large">
                            <h4>Rendimiento del Sistema</h4>
                            <div class="metric">
                                <span>Tiempo de Respuesta:</span>
                                <strong>128ms</strong>
                            </div>
                            <div class="metric">
                                <span>Disponibilidad:</span>
                                <strong>99.8%</strong>
                            </div>
                            <div class="metric">
                                <span>Errores (24h):</span>
                                <strong>12</strong>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Scripts CORREGIDOS -->
    <script src="../public/js/auth.js"></script>
    <script>
        // SISTEMA ADMIN CORREGIDO - Embedded para evitar errores
        class AdminSystem {
            constructor() {
                this.currentPanel = 'dashboardPanel';
                this.init();
            }

            init() {
                console.log('üõ†Ô∏è Inicializando AdminSystem...');
                this.setupEventListeners();
                this.loadDashboardData();
                console.log('‚úÖ AdminSystem listo');
            }

            setupEventListeners() {
                // Navegaci√≥n entre paneles
                const navButtons = document.querySelectorAll('.nav-btn');
                navButtons.forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        const panelId = e.target.getAttribute('data-panel');
                        if (panelId) {
                            this.showPanel(panelId);
                        }
                    });
                });

                // Bot√≥n logout
                const logoutBtn = document.getElementById('logoutBtn');
                if (logoutBtn) {
                    logoutBtn.addEventListener('click', (e) => {
                        e.preventDefault();
                        this.logout();
                    });
                }

                console.log('‚úÖ Event listeners configurados');
            }

            showPanel(panelId) {
                console.log('üîÑ Cambiando a panel:', panelId);
                
                // Ocultar todos los paneles
                const panels = document.querySelectorAll('.admin-panel');
                panels.forEach(panel => {
                    panel.classList.remove('active');
                });

                // Mostrar panel seleccionado
                const targetPanel = document.getElementById(panelId);
                if (targetPanel) {
                    targetPanel.classList.add('active');
                } else {
                    console.error('‚ùå Panel no encontrado:', panelId);
                }

                // Actualizar botones de navegaci√≥n
                const navButtons = document.querySelectorAll('.nav-btn');
                navButtons.forEach(btn => {
                    btn.classList.remove('active');
                    if (btn.getAttribute('data-panel') === panelId) {
                        btn.classList.add('active');
                    }
                });

                this.currentPanel = panelId;
            }

            loadDashboardData() {
                try {
                    console.log('üìä Cargando datos del dashboard...');
                    
                    // Simular carga de datos
                    const user = localStorage.getItem('cyclobot_user') || 'Administrador';
                    const userElement = document.getElementById('adminUser');
                    
                    if (userElement) {
                        userElement.textContent = user;
                    }

                    // Actualizar estad√≠sticas
                    const stats = {
                        problemsCount: '724',
                        effectivenessRate: '87%',
                        dbStatus: 'Conectada',
                        usersCount: '1,284'
                    };

                    Object.keys(stats).forEach(key => {
                        const element = document.getElementById(key);
                        if (element) {
                            element.textContent = stats[key];
                        }
                    });

                    console.log('‚úÖ Datos del dashboard cargados');
                } catch (error) {
                    console.error('‚ùå Error cargando dashboard:', error);
                }
            }

            loadTableData() {
                console.log('üóÉÔ∏è Cargando datos de tabla...');
                const tableSelector = document.getElementById('tableSelector');
                const tableBody = document.getElementById('tableBody');
                
                if (!tableBody) {
                    console.error('‚ùå tableBody no encontrado');
                    return;
                }

                const selectedTable = tableSelector ? tableSelector.value : 'problems';
                
                // Datos de ejemplo
                const sampleData = {
                    problems: [
                        { id: 1, name: 'PC no enciende', category: 'Hardware', status: 'Activo' },
                        { id: 2, name: 'Error de blue screen', category: 'Software', status: 'Resuelto' },
                        { id: 3, name: 'Sin conexi√≥n a internet', category: 'Redes', status: 'Activo' }
                    ],
                    categories: [
                        { id: 1, name: 'Hardware', count: '45 problemas', status: 'Activo' },
                        { id: 2, name: 'Software', count: '32 problemas', status: 'Activo' }
                    ],
                    users: [
                        { id: 1, name: 'admin', role: 'Administrador', status: 'Activo' }
                    ]
                };

                const data = sampleData[selectedTable] || [];
                
                if (data.length === 0) {
                    tableBody.innerHTML = `
                        <tr>
                            <td colspan="5" style="text-align: center; padding: 2rem;">
                                <i class="fas fa-exclamation-triangle"></i>
                                <br>No hay datos disponibles
                            </td>
                        </tr>
                    `;
                    return;
                }

                tableBody.innerHTML = data.map(item => `
                    <tr>
                        <td>${item.id}</td>
                        <td>${item.name}</td>
                        <td>${item.category || item.role || '-'}</td>
                        <td><span class="status-badge">${item.status}</span></td>
                        <td>
                            <button class="btn-small" onclick="adminSystem.editItem(${item.id})">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="btn-small btn-danger" onclick="adminSystem.deleteItem(${item.id})">
                                <i class="fas fa-trash"></i>
                            </button>
                        </td>
                    </tr>
                `).join('');

                console.log('‚úÖ Datos de tabla cargados:', selectedTable);
            }

            checkDatabase() {
                console.log('üîç Verificando conexi√≥n a BD...');
                // Simular verificaci√≥n
                setTimeout(() => {
                    this.showMessage('‚úÖ Conexi√≥n a base de datos establecida', 'success');
                }, 1000);
            }

            exportData() {
                console.log('üì§ Exportando datos...');
                this.showMessage('üì• Preparando exportaci√≥n de datos...', 'info');
            }

            logout() {
                console.log('üö™ Cerrando sesi√≥n...');
                if (confirm('¬øEst√°s seguro de que quieres cerrar sesi√≥n?')) {
                    localStorage.removeItem('cyclobot_admin');
                    localStorage.removeItem('cyclobot_user');
                    window.location.href = '../admin/login.html';
                }
            }

            showMessage(text, type = 'info') {
                // Usar el sistema de mensajes de auth.js si est√° disponible
                if (window.authSystem && window.authSystem.showMessage) {
                    window.authSystem.showMessage(text, type);
                } else {
                    alert(text);
                }
            }
        }

        // Inicializar cuando el DOM est√© listo
        document.addEventListener('DOMContentLoaded', function() {
            window.adminSystem = new AdminSystem();
        });
    </script>
</body>
</html>
